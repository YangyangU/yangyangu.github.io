---
title: ä¸€æ–‡ææ‡‚ HTTP ç¼“å­˜
date: 2024-04-22 16:00:00
tags: [HTTP]
categories: HTTP
index_img: /img/http.png
banner_img: /img/default.png
---

> HTTP ç¼“å­˜å¯è°“å‰ç«¯å·¥ç¨‹å¸ˆå¿…å¤‡æŠ€èƒ½ä¹‹ä¸€ï¼Œåœ¨æœ€è¿‘çš„é¢è¯•ä¸­ï¼Œä¹Ÿç»å¸¸è¢«é—®åˆ°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦æœ‰ HTTP ç¼“å­˜ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä¸‹é¢å’±ä»¬å±•å¼€æ¥å¥½å¥½èŠèŠã€‚

è¿˜ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ HTTPï¼Ÿå¯ä»¥è·³è½¬åˆ°æˆ‘çš„å‰ä¸€ç¯‡æ–‡ç« â€”â€” [æ‹ä¸€ä¸‹ HTTP å‘å±•å² - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7351700046486863881)

## ä¸ºä»€ä¹ˆè¦æœ‰ HTTP ç¼“å­˜

ç¼“å­˜ç¼“å­˜ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å°†ä¸€äº›èµ„æºä¿å­˜åœ¨æœ¬åœ°ï¼Œåç»­è¯·æ±‚æ—¶å°±å¯ä»¥ç›´æ¥åœ¨æœ¬åœ°è¯»å–ï¼Œè€Œä¸ç”¨è¯·æ±‚æœåŠ¡å™¨ã€‚ä½¿ç”¨ HTTP ç¼“å­˜æ˜¯æé«˜æ€§èƒ½ä¼˜åŒ–å’Œæå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®æŠ€æœ¯ï¼Œå®ƒä¸»è¦ä½“ç°åœ¨å‡ ä¸ªæ–¹é¢ï¼š

> 1.  **å‡å°‘å»¶è¿Ÿ**ï¼šå½“èµ„æºè¢«ç¼“å­˜åï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥ä»æµè§ˆå™¨ç¼“å­˜æˆ–æ›´è¿‘çš„ç½‘ç»œèŠ‚ç‚¹ï¼ˆå¦‚ CDNï¼‰è·å–æ•°æ®ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½è¯·æ±‚åŸå§‹æœåŠ¡å™¨ã€‚ç½‘ç»œå»¶è¿Ÿå’Œæ•°æ®ä¼ è¾“æ—¶é—´éƒ½å¤§å¤§ç¼©çŸ­äº†ã€‚
> 1.  **å‡è½»æœåŠ¡å™¨è´Ÿæ‹…**ï¼šé€šè¿‡ç¼“å­˜å¸¸ç”¨èµ„æºï¼ˆå¦‚ Logoï¼‰ï¼ŒæœåŠ¡å™¨ä¸å¿…æ¯æ¬¡éƒ½å¤„ç†ç›¸åŒçš„è¯·æ±‚ã€‚
> 1.  **èŠ‚çº¦å¸¦å®½**ï¼šç¼“å­˜å¯ä»¥æ˜¾è‘—å‡å°‘éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“çš„æ•°æ®é‡ï¼Œé™ä½ç”¨æˆ·å’Œä¾›åº”å•†çš„æµé‡æˆæœ¬ã€‚
> 1.  **æ”¹å–„ç”¨æˆ·ä½“éªŒ**ï¼šç¼“å­˜ä½¿å¾—ç½‘é¡µã€å›¾ç‰‡ç­‰å†…å®¹çš„åŠ è½½æ›´å¿«ï¼Œä»è€Œç›´æ¥æé«˜äº†ç”¨æˆ·çš„æµè§ˆä½“éªŒã€‚
> 1.  **ç¦»çº¿æµè§ˆ**ï¼šHTTP ç¼“å­˜åœ¨ä¸€äº›åœºæ™¯å¯ä»¥è®©ç”¨æˆ·åœ¨æ²¡æœ‰ç½‘ç»œè¿æ¥çš„æƒ…å†µä¸‹ï¼Œä»ç„¶èƒ½å¤Ÿè®¿é—®å…ˆå‰åŠ è½½è¿‡çš„å†…å®¹ã€‚ï¼ˆå¦‚ç½‘æ˜“äº‘éŸ³ä¹å¯ä»¥ç¦»çº¿å¬ä¹‹å‰ç¼“å­˜è¿‡çš„æ­Œï¼‰
> 1.  **è´Ÿè½½å‡è¡¡**ï¼šé€šè¿‡åœ¨å¤šä¸ªåœ°ç†ä½ç½®ç¼“å­˜å†…å®¹ï¼Œé¿å…æ‰€æœ‰è¯·æ±‚éƒ½é›†ä¸­åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šã€‚å¯ä»¥æœ‰æ•ˆå¤„ç†é«˜æµé‡å’Œå¤§è§„æ¨¡åˆ†å¸ƒçš„ç”¨æˆ·ã€‚

æ€»ä¹‹ï¼ŒHTTP ç¼“å­˜æ˜¯å‰ç«¯å¼€å‘è€…å¿…å¤‡ä¸€é¡¹è‡³å…³é‡è¦çš„æŠ€èƒ½ï¼Œè¯ä¸å¤šè¯´ï¼Œå¼€å§‹ä»‹ç»ï¼

## HTTP ç¼“å­˜

HTTP ç¼“å­˜æ˜¯ä¸€ç§å®¢æˆ·ç«¯ç¼“å­˜ï¼Œå½“æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€èµ„æºè¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨å“åº”å¤´ä¸­æŸ¥çœ‹æ˜¯å¦åŒ…å«ç¼“å­˜ç›¸å…³çš„ä¿¡æ¯ã€‚æµè§ˆå™¨ä¾æ®è¿™äº›ä¿¡æ¯ç¼“å­˜å“åº”èµ„æºï¼Œå†æ¬¡è¯·æ±‚æ—¶å¦‚æœå‘½ä¸­ç¼“å­˜åˆ™ç›´æ¥è¯»å–æœ¬åœ°ç¼“å­˜èµ„æºï¼Œè€Œä¸å†å‘è¯·æ±‚ã€‚HTTP ç¼“å­˜åˆ†ä¸º**å¼ºç¼“å­˜**å’Œ**åå•†ç¼“å­˜**ã€‚

### å¼ºç¼“å­˜

å¼ºç¼“å­˜ç›´æ¥å†³å®šäº†æµè§ˆå™¨æ˜¯å¦éœ€è¦å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œåªéœ€è¦è®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ã€‚å¦‚æœå¼ºç¼“å­˜æœ‰æ•ˆï¼Œæµè§ˆå™¨å°†ç›´æ¥ä»æœ¬åœ°ç¼“å­˜ä¸­è¯»å–èµ„æºï¼Œä¸ä¼šä¸æœåŠ¡å™¨è¿›è¡Œä»»ä½•äº¤äº’ã€‚

#### Cache-Control

`Cache-Control`æ˜¯é€šç”¨æ¶ˆæ¯å¤´å­—æ®µï¼Œè¢«ç”¨äºåœ¨ HTTP è¯·æ±‚å’Œå“åº”ä¸­ï¼Œé€šè¿‡æŒ‡å®šæŒ‡ä»¤æ¥å®ç°ç¼“å­˜æœºåˆ¶ï¼Œé€šè¿‡è®¾ç½®`max-age=xxx`æ¥æŒ‡å®šèµ„æºåœ¨ç¼“å­˜ä¸­å¯ä»¥å­˜æ´»çš„æœ€å¤§æ—¶é—´ï¼ˆå•ä½æ˜¯ç§’ï¼‰ã€‚

ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

è¿™é‡Œæˆ‘ä»¬ç¼“å­˜ä¸€ä¸ªå›¾ç‰‡èµ„æºï¼Œè¿‡æœŸæ—¶é—´ä¸º 86400 ç§’å³ä¸€å¤©

```js
res.writeHead(200, {
  "Content-Type": mime.lookup(ext),
  "cache-control": "max-age=86400", //ç¼“å­˜ä¸€å¤©
});
```

å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œä¼šæ­£å¸¸å‘è¯·æ±‚æ‹¿åˆ°èµ„æº

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba6bdbf76f7f4142adf814f086a56034~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=998&h=281&s=22453&e=png&b=fdfdfd)

ä½†å½“æˆ‘ä»¬åˆ·æ–°é¡µé¢å†æ¬¡å‘è¯·æ±‚æ—¶å‘ç°ï¼Œæ­¤æ—¶çš„å±¥è¡Œè€…å˜ä¸º`memory cache`ï¼Œå¤§å°å’Œæ—¶é—´éƒ½å˜ä¸º 0ï¼Œè¯´æ˜è¿™æ¬¡çš„èµ„æºå¹¶ä¸æ˜¯ä»æœåŠ¡å™¨è¯·æ±‚å›æ¥çš„ï¼Œè€Œæ˜¯æ¥è‡ªæœ¬åœ°å†…å­˜ç¼“å­˜ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/760581758f064a0ca785bd599eb88c2b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=981&h=291&s=34416&e=png&b=fdfdfd)

å¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨å“åº”å¤´ä¸­æŸ¥çœ‹`Cache-Control`å­—æ®µå’Œæˆ‘ä»¬è®¾ç½®çš„è¿‡æœŸæ—¶é—´ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ec48160b7fc4e3fb31dee812ba8e9d3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=569&h=401&s=28906&e=png&b=fefdfd)

å½“ç„¶`Cache-Control`ä¸æ­¢åªå…è®¸æˆ‘ä»¬è®¾ç½®`max-age`è¿‡æœŸæ—¶é—´ï¼Œè¿˜æœ‰å…¶ä»–å­—æ®µï¼Œè¯¦æƒ…å¯å‚è€ƒ [Cache-Control - HTTP | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control#%E7%BC%93%E5%AD%98%E8%AF%B7%E6%B1%82%E6%8C%87%E4%BB%A4)

#### Expires

`Expires`å“åº”å¤´æ˜¯ä¸€ä¸ªå…·ä½“çš„æ—¥æœŸ/æ—¶é—´ï¼Œå‘Šè¯‰æµè§ˆå™¨åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¹‹å‰ä¸éœ€è¦é‡æ–°è¯·æ±‚èµ„æºã€‚

> âš ï¸ æ³¨æ„ï¼šå¦‚æœå“åº”ä¸­æœ‰æŒ‡ä»¤ä¸º Â `max-age`Â  æˆ– Â `s-maxage`Â  çš„`Cache-Control`æ ‡å¤´ï¼Œåˆ™ Â `Expires`Â  æ ‡å¤´ä¼šè¢«å¿½ç•¥ã€‚

ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```js
res.writeHead(200, {
  "Content-Type": mime.lookup(ext),
  Expires: "Mon Apr 22 2024 21:03:31 GMT+0800", //è¿‡æœŸæ—¶é—´æˆ³è‡ªå·±é€‰æ‹©
});
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38882c45d14349289b70dfb5937a5fc1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=707&h=405&s=30659&e=png&b=fefefe)

ä¸`Cache-Control`ç”¨æ³•ç›¸ä¼¼ï¼Œå°±ä¸è¿‡å¤šèµ˜è¿°ã€‚

### åå•†ç¼“å­˜

å½“å¼ºç¼“å­˜è¿‡æœŸæˆ–æ— æ•ˆæ—¶ï¼Œæµè§ˆå™¨å°±ä¼šä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œé€šè¿‡å‘é€å¸¦æœ‰ç‰¹å®šéªŒè¯å¤´çš„è¯·æ±‚æ¥æ£€æŸ¥èµ„æºæ˜¯å¦è¢«ä¿®æ”¹ã€‚å¦‚æœæœåŠ¡å™¨ç¡®è®¤ç¼“å­˜èµ„æºä»ç„¶æ˜¯æœ€æ–°çš„ï¼Œåˆ™è¿”å› 304 çŠ¶æ€ç ï¼Œæµè§ˆå™¨ä¼šä»æœ¬åœ°ç¼“å­˜åŠ è½½èµ„æºã€‚å¦‚æœèµ„æºä¸æ˜¯æœ€æ–°çš„ï¼Œåˆ™è¿”å› 200 çŠ¶æ€ç å’Œæ–°çš„èµ„æºæ•°æ®ã€‚

#### Last-Modified å’Œ If-Modified-Since

æœåŠ¡å™¨åœ¨å“åº”ä¸­æä¾›`Last-Modified`æ—¥æœŸï¼Œè¡¨æ˜èµ„æºæœ€åä¿®æ”¹æ—¶é—´ã€‚æµè§ˆå™¨åœ¨åç»­è¯·æ±‚ä¸­ä½¿ç”¨`If-Modified-Since`å¤´åŒ…å«è¿™ä¸ªæ—¥æœŸï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šçš„èµ„æºè‡ªé‚£ä»¥åæœªä¿®æ”¹ï¼Œå°±ä¼šè¿”å› 304 çŠ¶æ€ç ã€‚

ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼š

```js
const stats = fs.statSync(filePath); //è·å–æ–‡ä»¶æ–‡ä»¶ä¿®æ”¹æ—¶çš„æ—¶é—´æˆ³
const timeStamp = req.headers["if-modified-since"]; //è·å–è¯·æ±‚å¤´å­—æ®µ
let status = 200; //èµ„æºä¿®æ”¹
if (timeStamp && Number(timeStamp) === stats.mtimeMs) {
  //æ—¶é—´æˆ³ä¸å˜
  status = 304; //èµ„æºæœªä¿®æ”¹
}

res.writeHead(status, {
  "Content-Type": mime.lookup(ext),
  "last-modified": stats.mtimeMs, //æ—¶é—´æˆ³
});
```

é€šè¿‡å¯¹æ¯”è¿™æ¬¡è¯·æ±‚å¤´çš„`if-modified-since`å’Œå“åº”å¤´çš„`last-modified`åˆ¤æ–­èµ„æºæ˜¯å¦ä¿®æ”¹

<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/494eff6380b14035b2c2b10872038d88~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=720&h=664&s=50192&e=png&b=fefefe" alt="image.png" width="70%" />

å½“èµ„æºæœªä¿®æ”¹ï¼Œè¿”å› 304 çŠ¶æ€ç ï¼Œä»ç¼“å­˜ä¸­æ‹¿èµ„æºã€‚

ç°åœ¨æˆ‘ä»¬è¯•è¯•æ‰‹åŠ¨ä¿®æ”¹èµ„æºï¼Œå†æ¬¡åˆ·æ–°é¡µé¢ï¼š

<img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c995a290776440df8a579378f5f45268~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=712&h=667&s=50667&e=png&b=fefefe" alt="image.png" width="70%" />

èµ„æºä¿®æ”¹ï¼Œä¸¤æ¬¡æ—¶é—´æˆ³ä¸åŒï¼Œè¿”å› 200 çŠ¶æ€ç ï¼Œå’Œæ–°çš„èµ„æºã€‚

#### ETag å’Œ If-None-Match

`ETag`æ˜¯èµ„æºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåæ˜ èµ„æºçš„å†…å®¹çŠ¶æ€ã€‚æµè§ˆå™¨å­˜å‚¨è¿™ä¸ªæ ‡è¯†å¹¶åœ¨åç»­è¯·æ±‚ä¸­é€šè¿‡`If-None-Match`å¤´å‘é€å®ƒã€‚å¦‚æœ`ETag`æœªæ”¹å˜ï¼ŒæœåŠ¡å™¨è¿”å› 304 çŠ¶æ€ç ã€‚

```js
if (req.headers["if-none-match"] === etag) {
  res.writeHead(304, {
    // æœªä¿®æ”¹ï¼Œè¿”å›304
    "Content-Type": mime.lookup(ext),
    ETag: etag,
  });
  return res.end();
}

res.writeHead(200, {
  //ä¿®æ”¹ï¼Œè¿”å›200
  "Content-Type": mime.lookup(ext),
  ETag: etag,
});
return res.end(content);
```

<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76f551ed1d2c4a0b8e8bec1f166665ff~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=714&h=644&s=49796&e=png&b=fefefe" alt="image.png" width="70%" />

ä¸¤ç§åå•†ç¼“å­˜çš„åŒºåˆ«æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ—¶é—´æˆ³ä¸€ä¸ªæ¯”è¾ƒå“ˆå¸Œå€¼ã€‚

## æ€»ç»“

å¼ºç¼“å­˜é€šè¿‡è®¾ç½®è¿‡æœŸæ—¶é—´æ¥æ§åˆ¶èµ„æºçš„ç¼“å­˜ï¼›è€Œåå•†ç¼“å­˜åˆ™æ˜¯é€šè¿‡ä¸æœåŠ¡å™¨éªŒè¯èµ„æºçš„çŠ¶æ€æ¥å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜ã€‚åå•†ç¼“å­˜å¯ä»¥é¿å…å¼ºç¼“å­˜çš„ä¸è¶³ä¹‹å¤„ï¼Œæ¯”å¦‚å½“èµ„æºåœ¨æœ‰æ•ˆæœŸå†…ä½†å‘ç”Ÿäº†å˜åŒ–æ—¶ï¼Œåå•†ç¼“å­˜å¯ä»¥ä¿è¯å®¢æˆ·ç«¯è·å–åˆ°æœ€æ–°çš„èµ„æºã€‚

æœ€åé…ä¸€å¼ ä¸ªäººè§‰å¾—æ€»ç»“ååˆ†åˆ°ä½çš„å›¾ï¼ˆå›¾ç‰‡åœ°å€åœ¨æ–‡æœ«ï¼‰

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c58c2a8b007459ebeecb8fd3950a09f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=841&h=534&s=201743&e=png&b=eeeeee)

## å‚è€ƒ

- [HTTP ç¼“å­˜ - HTTP | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching)
- [å›¾è§£ HTTP ç¼“å­˜ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6844904153043435533?searchId=20240422101749A6A836A76242BD0217C2)
- [å›¾ç‰‡åœ°å€](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/5/10/171fea0fec0b4668~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.awebp)

## æœ€å

å·²å°†å­¦ä¹ ä»£ç ä¸Šä¼ è‡³ [github](https://github.com/YangyangU/CodeSpace)ï¼Œæ¬¢è¿å¤§å®¶å­¦ä¹ æŒ‡æ­£ï¼
